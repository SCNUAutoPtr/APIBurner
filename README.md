# 压力测试工具

这是一个基于 Rust 开发的 HTTP 压力测试工具，支持多进程、多线程并发测试，并提供实时 QPS 统计。

## 功能特点

- 支持多进程并发测试
- 支持多线程并发测试
- 实时 QPS 统计
- 可配置的测试持续时间
- 支持显示请求和响应内容
- 支持无限制模式（自动使用所有可用系统资源）
- 支持不等待响应模式（仅发送请求）

## 安装

确保您的系统已安装 Rust 开发环境，然后执行：

```bash
cargo build --release
```

## 使用方法

### 基本用法

```bash
cargo run -- [参数]
```

### 参数说明

| 参数 | 短选项 | 长选项 | 默认值 | 说明 |
|------|--------|--------|--------|------|
| 进程数 | -p | --processes | 4 | 并发进程数 |
| 线程数 | -t | --threads | 10 | 每个进程的线程数 |
| 持续时间 | -d | --duration | 60 | 测试持续时间（秒） |
| 目标URL | -u | --url | http://10.191.31.203:9000/auth/local | 测试目标URL |
| 显示响应 | -s | --show-response | false | 是否显示请求和响应内容 |
| QPS窗口 | -q | --qps-window | 1 | QPS统计窗口大小（秒） |
| 无限制模式 | -l | --unlimited | false | 使用所有可用资源运行10秒 |
| 不等待响应 | -n | --no-response | false | 仅发送请求，不等待响应 |

### 使用示例

1. 基本测试（使用默认参数）：
```bash
cargo run
```

2. 自定义参数测试：
```bash
cargo run -- -p 8 -t 20 -d 120 -u http://example.com -s
```

3. 无限制模式测试：
```bash
cargo run -- -l
```

4. 不等待响应模式测试：
```bash
cargo run -- -n
```

### 无限制模式说明

当启用无限制模式（-l 或 --unlimited）时：
- 进程数将自动设置为 CPU 核心数
- 每个进程的线程数将设置为 CPU 核心数的 2 倍
- 测试时间固定为 10 秒
- 将使用系统所有可用资源进行测试

### 不等待响应模式说明

当启用不等待响应模式（-n 或 --no-response）时：
- 请求超时时间设置为 1 毫秒
- 不等待服务器响应
- 可以产生更大的请求压力
- 适合测试系统极限性能

## 输出说明

程序运行时会显示：
1. 测试配置信息
2. 实时 QPS 统计
3. 测试结果汇总（总请求数、总耗时、平均 RPS）

## 注意事项

1. 无限制模式会使用系统所有可用资源，请谨慎使用
2. 建议先用较小的并发数进行测试，再逐步增加
3. 显示响应内容（-s）会降低测试性能，建议仅在调试时使用
4. 不等待响应模式（-n）会产生极大的系统压力，请确保目标系统能够承受

## 性能优化建议

1. 根据目标服务器性能调整并发数
2. 使用无限制模式（-l）可以快速测试系统最大性能
3. 使用不等待响应模式（-n）可以测试系统极限性能
4. 适当调整 QPS 统计窗口大小，以获得更准确的统计数据 